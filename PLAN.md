# BladeFree Development Plan

## Phase 1: Project Setup & Core Mechanics

- [x] **Environment Setup:**
    - [x] Create `index.html` for the game host.
    - [x] Include Phaser 3 library (CDN or local file).
    - [x] Create `game.js` for game code.
    - [x] Initialize basic Phaser Game instance in `game.js` (set dimensions).
    - [x] Set up a local web server (e.g., using `npm install -g http-server` and running `http-server`).
- [x] **Create Main Game Scene (`GameplayScene`):**
    - [x] Define the `GameplayScene` class extending `Phaser.Scene`.
    - [x] Add `GameplayScene` to the Phaser game configuration.
    - [x] `preload`: Load placeholder inline skater asset.
    - [x] `create`: Add inline skater sprite.
    - [x] `create`: Enable Arcade Physics on the inline skater sprite.
- [x] **Player Movement:**
    - [x] `create`: Set up keyboard listeners (Left/Right arrows).
    - [x] `update`: Check key presses.
    - [x] `update`: Apply horizontal velocity/position change for movement.
    - [x] `update`: Constrain inline skater movement within screen bounds.
- [x] **Basic Scrolling World:**
    - [x] Keep player Y position relatively fixed.
    - [x] Define a constant scroll speed for obstacles/world elements.

## Phase 2: Obstacles & Collision

- [x] **Obstacle Creation:**
    - [x] `preload`: Load placeholder obstacle assets (e.g., cone, rock). *(Replaced with sprite frames)*
    - [x] `create`: Create a Phaser Group for obstacles (`this.obstacles`).
    - [x] Implement timed event/function to spawn obstacles periodically.
    - [x] Spawn obstacles above the top screen edge.
    - [x] Add spawned obstacles to the `obstacles` group.
    - [x] Set obstacle vertical velocity (moving down screen).
    - [x] Implement logic to destroy obstacles when they go off-screen below.
- [x] **Collision Detection:**
    - [x] `create`: Set up physics collider between player and `obstacles` group.
    - [x] Create `handleCollision(player, obstacle)` function.
    - [x] `handleCollision`: Implement initial game over logic (e.g., stop player, log message). *(Now transitions to GameOverScene)*

## Phase 3: Scoring & UI

- [x] **Basic Score:**
    - [x] Initialize `this.score = 0` in `create` or `init`.
    - [x] `update`: Increment score based on time/distance. *(Also increments on tricks/collect)*
    - [x] `preload`: Load font or prepare to use default text.
    - [x] `create`: Create `this.scoreText` Phaser Text object.
    - [x] `create`: Position score text (e.g., top-right).
    - [x] `update`: Update `this.scoreText.setText()`.
- [x] **High Score:**
    - [x] `create`/`init`: Load high score from `localStorage` (default to 0).
    - [x] `create`: Create `this.highScoreText` Phaser Text object.
    - [x] `create`: Position high score text.
    - [x] `handleCollision`: Compare final score with high score.
    - [x] `handleCollision`: If higher, update high score variable and save to `localStorage`.
    - [x] `GameOverScene`: Implement new high score celebration.
        - [x] Display "New High Score!" message prominently.
        - [x] Show a graphic of the inline skater with a medal or trophy. (Cycling item animation and medal sprite added and animated)
        - [ ] Play a special sound effect. *(No specific new sound effect added for this yet)*
        - [x] `preload` new graphic assets for medal/trophy. (Frames from skater.png used for cycling items and medal)
        - [ ] `preload` new sound effect.
    - [x] Add secret key combination (e.g., Shift+Delete) to reset high score in `localStorage`.
    - [x] Add mobile-friendly high score reset (e.g., tap small icon in GameOverScene, show confirmation screen).
- [x] **Inventory System & Collection Bonus:**
    - [x] `GameplayScene`: Define a list of all inventory items (e.g., using frame indices from `collectibleData`). *(Excludes helmet)*
    - [x] `GameplayScene`: Add a data structure to track collected inventory items (e.g., `this.playerInventory = {}`).
    - [x] `GameplayScene.create`:
        - [x] Create UI elements (sprites) at the top of the screen to represent each inventory item.
        - [x] Initially, display these UI item sprites as grayed out or lightened (e.g., `setTint(0xaaaaaa)`).
        - [x] Store references to these UI item sprites.
    - [x] `GameplayScene.handleCollect`:
        - [x] When a collectible that is part of the inventory set is collected:
            - [x] Mark the item as collected in `this.playerInventory`.
            - [x] Update the corresponding UI item sprite to its normal appearance (remove tint).
            - [x] Check if all inventory items have been collected.
    - [x] `GameplayScene.update` or `handleCollect`:
        - [x] If all inventory items are collected:
            - [x] Award a significant bonus (e.g., 500 points).
            - [x] Display "COLLECTION COMPLETE!" message.
            - [x] Potentially reset the inventory (or make it a one-time bonus per game). *(Implemented as repeatable)*
    - [x] `GameplayScene.create` (on restart): Reset `this.playerInventory` and UI item appearances.
    - [x] Ensure helmet is handled separately if it's not part of this specific inventory collection goal, or decide if it is. *(Helmet is separate)*

## Phase 4: Tricks, Collectibles & Game States

- [ ] **Active Jumping Mechanics:**
    - [ ] **Input:**
        - [ ] `GameplayScene.create`: Add keyboard listeners for Jump (Up Arrow, Spacebar).
        - [ ] `GameplayScene.create`: Add touch input for Jump (e.g., swipe up, or a dedicated jump button area on mobile).
    - [ ] **Player State:**
        - [ ] `GameplayScene`: Add `canJump` boolean flag (true when on ground, false when airborne/grinding).
        - [ ] `GameplayScene.update`: Manage `canJump` state (set to true on landing, false on jump/leaving ground).
    - [ ] **Jumping Action:**
        - [ ] `GameplayScene.update` or new `handleJumpInput()`:
            - [ ] If jump input detected and `canJump` is true:
                - [ ] Apply upward velocity (`JUMP_VELOCITY`).
                - [ ] Set `isJumping = true`, `canJump = false`.
                - [ ] Play jump sound.
                - [ ] Play "jump takeoff" or "airborne" animation.
    - [ ] **Interaction with Ramps:**
        - [ ] `GameplayScene.handleRampOverlap`:
            - [ ] If player *actively jumps* just before or on the ramp: Perform a "big air" jump (higher velocity, airborne/grab pose animation).
            - [ ] If player *does not jump* but rides onto the ramp: Perform a "small air" jump (lower velocity, simpler/no special airborne pose, or just a slight lift).
            - [ ] Points awarded might differ based on jump type.
    - [ ] **Interaction with Rails/Ledges:**
        - [ ] `GameplayScene.handleGrindOverlap` (or collider):
            - [ ] Player must *actively jump* onto a rail/ledge to start grinding.
            - [ ] If player simply skates into a rail without jumping, it's a collision (`handleCollision`).
            - [ ] Consider a small "hop" animation if jumping onto a rail.
        - [ ] `GameplayScene.update`: Allow player to jump *off* a rail (ends grind, sets `isJumping`).
    - [ ] **Interaction with Obstacles:**
        - [ ] Player can jump *over* some obstacles if their jump height and timing are correct.
        - [ ] This might require adjusting obstacle hitboxes or player's hitbox while airborne.
    - [ ] **Landing on Rails:**
        - [ ] If player is airborne (from ramp or regular jump) and lands on a grindable:
            - [ ] Initiate grind sequence.
            - [ ] Play landing-on-rail sound/effect.
- [x] **Ramps & Jumps (Passive - to be revised with Active Jumping):**
    - [x] `preload`: Load ramp asset. *(Placeholder done)*
    - [x] `create`: Create `ramps` group.
    - [x] Implement spawning logic for ramps.
    - [x] `create`: Set up physics *overlap* check between player and `ramps`.
    - [x] Create `handleRampOverlap(player, ramp)` function.
    - [x] `handleRampOverlap`: Trigger jump state (velocity change, animation). *(Current: automatic small air)*
    - [x] `handleRampOverlap`: Add points for the jump.
    - [x] `handleRampOverlap`: Play jump sound/visual effect. *(Sound and point popup done)*
- [x] **Rails/Ledges & Grinding (Passive - to be revised with Active Jumping):**
    - [x] `preload`: Load rail/ledge asset. *(Placeholder done)*
    - [x] `create`: Create `grindables` group.
    - [x] Implement spawning logic for grindables.
    - [x] `create`: Set up physics *overlap* check between player and `grindables`.
    - [x] Create `handleGrindOverlapStart(player, grindable)` function. *(Implemented in `handleGrindOverlap`)*
    - [x] Create `handleGrindOverlapEnd(player, grindable)` function (or check in `update`). *(Implemented as `endGrind` and check in `update`)*
    - [x] `handleGrindOverlapStart`: Enter grinding state (snap position, change animation, sparks). *(Snap position and animation done)*
    - [x] `update` (while grinding): Add points based on duration.
    - [x] `handleGrindOverlapEnd`: Exit grinding state.
- [x] **Collectibles:**
    - [x] `preload`: Load collectible item assets (skates, wheels, etc.). *(Replaced with sprite frames)*
    - [x] `create`: Create `collectibles` group.
    - [x] Implement spawning logic for collectibles.
    - [x] `create`: Set up physics *overlap* check between player and `collectibles`.
    - [x] Create `handleCollect(player, item)` function.
    - [x] `handleCollect`: Add points to score.
    - [x] `handleCollect`: Play collection sound effect.
    - [x] `handleCollect`: Show temporary points pop-up text.
    - [x] `handleCollect`: Destroy the collected item sprite (`item.destroy()`).
- [x] **Game State Management:**
    - [x] Create `StartScene` class.
    - [x] Create `GameOverScene` class.
    - [x] Add scenes to Phaser game config.
    - [x] **`StartScene`:**
        - [x] Display "Press an arrow key to BladeFree" text.
        - [x] Listen for keyboard input (any arrow key).
        - [x] On input, transition to `GameplayScene` (`this.scene.start('GameplayScene')`).
    - [x] **`GameplayScene`:**
        - [x] `handleCollision`: Transition to `GameOverScene`, passing score (`this.scene.start('GameOverScene', { score: this.score })`).
    - [x] **`GameOverScene`:**
        - [x] `init(data)`: Receive score (`this.finalScore = data.score`).
        - [x] `create`: Display final score.
        - [x] `create`: Display high scores (load from `localStorage`).
        - [x] `create`: Implement/play funny game over animation (dog drag). *(Multi-stage dog drag implemented)*
        - [x] `create`: Display "Restart?" / "Quit?" options. *(Restart and Quit text added)*
        - [x] `create`: Add input listeners for restart/quit. *(Restart and Quit listeners added)*
        - [x] On Restart: `this.scene.start('GameplayScene')`.
        - [x] On Quit: Display "Later Blader ðŸ¤™" text. *(Image with spiral animation implemented)*
            - [x] Add clickable buttons to GameOverScene for "Restart" and "Quit" for mobile users.
- [x] **Rails/Ledges & Grinding (Enhancements):**
    - [x] `update` (while grinding): Add points based on duration.
    - [x] `GameplayScene.update`: Display a running total of points earned *during the current grind* near the player.
    - [x] `handleGrindOverlap`: Improve player snapping to align to the middle of the rail.
    - [x] `update`: Lock player's X position to the rail's X position while grinding.
    - [ ] `spawnObstacle`: Implement rails and ledges of different lengths.
        - [ ] Randomly determine length for grindable.
        - [ ] Create grindable placeholder/sprite with variable height.
        - [ ] Ensure physics body of grindable matches its visual height.
- [x] **Helmet Power-up:**
    - [x] `GameplayScene`: Add `hasHelmet` boolean flag.
    - [x] `GameplayScene`: `preload` helmet icon asset for UI. *(Used frame 27 from skater.png)*
    - [x] `GameplayScene`: `create` add UI element for helmet status (e.g., near score).
    - [x] `GameplayScene`: `handleCollect`:
        - [x] If collected item is a helmet:
            - [x] If `!hasHelmet`, set `hasHelmet = true`, update UI, display "SKULL PROTECTION" message.
            - [x] If `hasHelmet`, award points only.
    - [x] `GameplayScene`: `handleCollision`:
        - [x] If `hasHelmet`, set `hasHelmet = false`, update UI, play "helmet break" sound, prevent game over.
        - [x] Animate helmet flying off player on collision. *(Helmet icon hidden, new sprite falls and spins off screen, message displayed)*
        - [x] If `!hasHelmet`, proceed with game over.
    - [x] `GameplayScene`: `preload` "helmet break" sound. *(Current 'collide' sound deemed sufficient for helmet break)*

## Phase 5: Audio & Polish

- [x] **Sound Integration:**
    - [x] `preload`: Load background music file(s).
    - [x] `preload`: Load sound effect files (jump, grind, collect, collide, UI click).
    - [x] `create` (`GameplayScene`): Play background music (`loop: true`).
    - [x] Trigger sound effects on corresponding actions (`this.sound.play(...)`).
- [x] **Scene Music:**
    - [x] `StartScene`: `preload` and `create` music for the start screen.
    - [x] `StartScene`: Ensure music stops when transitioning to `GameplayScene`.
    - [x] `GameOverScene`: `preload` and `create` music for the game over screen (can reuse start screen music).
    - [x] `GameOverScene`: Ensure music stops when transitioning to `GameplayScene`.
    - [x] `GameplayScene`: Ensure its music stops when transitioning to `GameOverScene` and `StartScene` music stops if transitioning from there. *(Gameplay to GameOver was already handled; StartScene transition now also handles its music)*.
- [ ] **Audio Controls:**
    - [ ] `index.html`: Add mute button element. *(This refers to HTML-based controls)*
    - [x] `game.js`/UI: Implement `toggleMute()` function (`this.sound.mute`). *(In-game Phaser button implemented)*
    - [x] `game.js`/UI: Update mute button appearance based on state. *(In-game Phaser button implemented)*
    - [ ] `game.js`/UI: Persist mute state in `localStorage`.
    - [ ] `index.html`: Add volume slider element (range input).
    - [ ] `game.js`/UI: Implement `setVolume(value)` function (`this.sound.volume`).
    - [ ] `game.js`/UI: Persist volume level in `localStorage`.
- [ ] **Graphics & Animation:**
    - [x] Replace placeholders with final retro-style graphics (inspired by `roy_skate1.png`). *(Obstacles and Collectibles done)*
    - [x] Replace ramp placeholder with final graphics.
        - [x] `preload` new ramp asset(s). (`ramp.png` added)
        - [x] Update `spawnObstacle` to use new ramp graphics.
        - [x] Adjust physics body if needed. *(Dynamic sizing `spawnedItem.body.setSize(spawnedItem.width, spawnedItem.height)` considered sufficient)*
    - [x] Replace rail/ledge placeholder with final graphics.
        - [x] `preload` new rail/ledge asset(s). (`rail1.png` added)
        - [x] Update `spawnObstacle` to use new rail/ledge graphics.
        - [x] Adjust physics body if needed. *(Dynamic sizing `spawnedItem.body.setSize(spawnedItem.width, spawnedItem.height)` considered sufficient)*
        - [ ] Consider variable lengths for future.
    - [x] Create sprite sheets for player animations (skating, jumping, grinding, falling).
    - [x] Use Phaser's animation manager (`this.anims.create`) to define animations.
    - [x] Play correct player animation based on state.
    - [ ] Add crash animation when inline skater collides (distinct from dog-drag setup).
    - [ ] Add particle effects (grind sparks, jump poof).
    - [x] Implement point pop-up visuals.
    - [x] Change background color/add background image. *(Canvas background color changed to asphalt texture)*
- [x] **Mobile Controls:**
    - [x] `create`: Add touch input listeners (`this.input.on('pointerdown', ...)`).
    - [x] Implement logic to detect touch on left/right screen halves.
    - [x] Trigger player movement based on touch location.
    - [x] Handle touch end (`pointerup`) to stop movement.

## Phase 6: Testing & Balancing

- [ ] **Playtesting:**
    - [ ] Test thoroughly on desktop browsers.
    - [ ] Test thoroughly on mobile browsers.
    - [ ] Adjust game parameters (speed, frequency, points) for fun and challenge.
    - [ ] Identify and fix bugs.
    - [ ] Optimize performance if needed.
- [ ] **Difficulty Scaling:**
    - [x] `GameplayScene`: Add `timeSurvived` counter. *(Fulfilled by `sceneRunningTime`)*
    - [x] `GameplayScene`: `update`: Increment `timeSurvived`. *(Fulfilled by `sceneRunningTime += delta`)*
    - [x] Implement multi-tiered horizontal speed increase for obstacles based on `sceneRunningTime`. (3 tiers implemented)
    - [ ] `GameplayScene`: `update`: Gradually increase `SCROLL_SPEED` based on `timeSurvived`.
        - [ ] Define a base scroll speed and a maximum scroll speed.
        - [ ] Define how quickly the speed increases (e.g., per second or per score milestone).
    - [ ] Consider other difficulty scaling factors (e.g., obstacle density, spawn patterns). *(Spawn rate increase by score is implemented)*

## Phase 7: Deployment & Optimization

- [ ] **Asset Optimization:**
    - [ ] Review all image assets (`.png`) and optimize their file sizes (e.g., using tools like TinyPNG or ImageOptim) without significant quality loss.
    - [ ] Review all audio assets (`.mp3`) and ensure they are compressed appropriately (e.g., adjust bitrate if necessary).
    - [ ] Consider using more efficient image formats if appropriate (e.g., WebP, though browser compatibility needs checking for older devices).
- [ ] **Code Optimization:**
    - [ ] Minify `game.js` for production deployment to reduce its file size.
    - [ ] Review code for any performance bottlenecks or unnecessary computations, especially in the `update` loops.
- [ ] **Self-Host JavaScript Libraries:**
    - [ ] Download the Phaser 3 library (`phaser.min.js`).
    - [ ] Store it locally within the project (e.g., in an `lib/` or `js/` directory).
    - [ ] Update `index.html` to load Phaser from the local path instead of the CDN.
- [ ] **General Lightweighting:**
    - [ ] Ensure no unused assets are being loaded.
    - [ ] Check for and remove any console logs or debug features not needed for production.
    - [ ] Test loading times on various connections and devices.
